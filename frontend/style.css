:root {
  --bg: #eef3fb;
  --panel: #ffffff;
  --stroke: #d9e1ef;
  --text: #101828;
}

* { font-family: 'Vazirmatn', sans-serif; }
body { margin: 0; background: var(--bg); color: var(--text); overflow: hidden; }

.topbar { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: rgba(255, 255, 255, 0.92); backdrop-filter: blur(8px); border-bottom: 1px solid var(--stroke); }
.topbar h1 { font-size: 1.15rem; font-weight: 800; }

.map-shell { position: relative; height: 100vh; padding-top: 70px; }
#map { height: calc(100vh - 70px); width: 100%; }

.floating-controls { position: absolute; top: 86px; right: 18px; z-index: 700; border-radius: 14px; box-shadow: 0 10px 40px rgba(15, 23, 42, 0.15); }
.search-input { min-width: 110px; max-width: 130px; }
.control-field { width: 180px; }

.map-legend { background: rgba(255,255,255,.95); border: 1px solid #dbe5f4; border-radius: 12px; padding: 10px; box-shadow: 0 8px 20px rgba(0,0,0,.15); line-height: 1.2; min-width: 165px; }
.map-legend h6 { margin: 0 0 8px 0; font-size: .84rem; }
.map-legend .head { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
.map-legend .toggle { border: 1px solid #dbe4f2; background: #f8fafc; border-radius: 6px; width: 24px; height: 24px; padding: 0; }
.map-legend .row-item { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; font-size: .8rem; }
.map-legend .sw { width: 14px; height: 14px; border-radius: 4px; border: 1px solid #fff; }
.map-legend.compact { min-width: auto; }
.map-legend .short { font-weight:700; width:24px; display:inline-block; }
.map-legend.compact .label { display: none; }
.map-legend.compact h6 { display: none; }
.leaflet-bottom.leaflet-right .map-legend { margin-bottom: 82px; }


.bottom-timeline { position: absolute; bottom: 12px; right: 50%; transform: translateX(50%); z-index: 700; border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.18); min-width: min(1550px, calc(100vw - 24px)); }
.timeline-date { width: 165px; }
.timeline-level { width: 170px; }
.month-strip-shell { border-top: 1px solid #e5e7eb; padding: 2px 8px; display: flex; align-items: center; gap: 6px; background: #fff; }
.strip-nav { border: 0; background: #f3f4f6; color: #475569; border-radius: 6px; width: 30px; height: 24px; line-height: 1; }
.month-strip { display: flex; overflow-x: auto; gap: 0; flex: 1; scrollbar-width: thin; align-items: center; }
.month-chip { border: 0; border-inline-end: 1px solid #e5e7eb; background: #fff; padding: 3px 8px; font-size: .72rem; cursor: pointer; white-space: nowrap; color: #64748b; }
.month-chip.active { color: #2563eb; font-weight: 700; background: #eff6ff; }
.month-chip .year-tag { display: block; font-size: .68rem; color: #f97316; line-height: 1; }

.insight-panel { position: absolute; top: 80px; left: 18px; width: min(430px, calc(100vw - 36px)); max-height: calc(100vh - 120px); overflow-y: auto; z-index: 800; background: var(--panel); border: 1px solid var(--stroke); border-radius: 18px; box-shadow: 0 20px 50px rgba(15, 23, 42, 0.28); padding: 18px; transform: translateX(-115%); transition: transform .28s ease; }
.insight-panel.open { transform: translateX(0); }
.close-panel-btn { border-radius: 999px; width: 34px; height: 34px; padding: 0; flex: 0 0 auto; }

.value-box { border: 1px solid #fde68a; background: #fffbeb; border-radius: 12px; padding: 10px 12px; transition: all .2s ease; }
.value-box.sev-NormalWet { background: #ecfdf5; border-color: #86efac; }
.value-box.sev-D0 { background: #fefce8; border-color: #fde047; }
.value-box.sev-D1 { background: #fffbeb; border-color: #fbbf24; }
.value-box.sev-D2 { background: #fff7ed; border-color: #fb923c; }
.value-box.sev-D3 { background: #fef2f2; border-color: #ef4444; }
.value-box.sev-D4 { background: #7f1d1d; border-color: #7f1d1d; color: #fff; }
.value-box.sev-D4 .main-value, .value-box.sev-D4 #mainMetricLabel { color: #fff !important; }

.main-value { font-size: 2rem; font-weight: 800; color: var(--severity-color, #ca8a04); line-height: 1.1; }
#mainMetricLabel { color: var(--severity-color, #ca8a04); font-weight: 600; }
.severity-badge { background: color-mix(in oklab, var(--severity-color, #fcd34d) 18%, white); border: 1px solid var(--severity-color, #fcd34d); color: var(--severity-color, #854d0e); border-radius: 99px; padding: 2px 10px; font-size: .8rem; }

.chart-wrap { height: 430px; border: 1px solid var(--stroke); border-radius: 12px; padding: 8px; }
#tsChart { width: 100%; height: 100%; }
.kpi-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
.kpi-card { background: #f8fafc; border: 1px solid var(--stroke); border-radius: 10px; padding: 8px 10px; }
.kpi-card small { display: block; color: #64748b; }
.kpi-card strong { font-size: 1.1rem; }
.trend-text { font-size: .92rem; color: #334155; }

@media (max-width: 768px) {
  .search-input { min-width: 100px; max-width: 120px; }
  .bottom-timeline { min-width: calc(100vw - 16px); }
}
