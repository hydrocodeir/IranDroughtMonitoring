:root {
  --panel: #ffffff;
  --stroke: #d9dde3;
  --text: #1f2937;
  --shadow: 0 10px 30px rgba(15, 23, 42, 0.16);
}

* { font-family: 'Inter', sans-serif; }
body { margin: 0; color: var(--text); overflow: hidden; }

.topbar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1200;
  background: #f2f2f2;
  border-bottom: 1px solid #dadde2;
  height: 64px;
}
.home-link { color: #f97316; text-decoration: none; font-size: 1.55rem; font-weight: 500; border-bottom: 3px solid #f97316; padding-bottom: 2px; }
.headline h1 { font-size: 2rem; color: #f25c05; font-weight: 700; }
.headline small { font-size: 1.4rem; color: #4b5563; }
.brand { font-size: 3rem; color: #1d4d8f; font-weight: 700; }

.map-shell { position: relative; height: 100vh; padding-top: 64px; }
#map { height: calc(100vh - 64px); width: 100%; background: #c9cbcf; }

.search-floating {
  position: absolute;
  top: 78px;
  left: 16px;
  z-index: 900;
  border-radius: 14px;
  width: 245px;
  box-shadow: var(--shadow);
}
.search-input { border: 0; box-shadow: none; }
.search-btn { border-radius: 8px; }

.layers-panel {
  position: absolute;
  top: 275px;
  left: 16px;
  width: 330px;
  z-index: 900;
  border-radius: 12px;
  box-shadow: var(--shadow);
}
.layers-panel h5 { font-size: 1.95rem; font-weight: 700; }
.layer-section h6 { font-size: 1.3rem; font-weight: 700; margin-bottom: 8px; }
.layer-section label { display: block; font-size: 1.5rem; margin-bottom: 8px; color: #334155; }
.layer-section input { margin-right: 8px; }
.layer-section .disabled { color: #9ca3af; }

.quick-tools {
  position: absolute;
  left: 16px;
  bottom: 140px;
  z-index: 900;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.tool-btn {
  width: 42px;
  height: 42px;
  border: 0;
  border-radius: 10px;
  background: white;
  box-shadow: var(--shadow);
}

.insight-panel {
  position: absolute;
  top: 76px;
  right: 14px;
  width: 440px;
  max-height: calc(100vh - 120px);
  overflow-y: auto;
  z-index: 950;
  background: var(--panel);
  border: 1px solid var(--stroke);
  border-radius: 14px;
  box-shadow: var(--shadow);
  padding: 14px;
  transform: translateX(110%);
  transition: transform .28s ease;
}
.insight-panel.open { transform: translateX(0); }
.insight-header h4 { font-size: 2.1rem; font-weight: 700; }
.close-panel-btn { width: 34px; height: 34px; border-radius: 50%; padding: 0; }
.region-meta { background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 10px; }
.region-meta #panelTitle { font-size: 1.6rem; }
.region-meta #panelSubtitle { font-size: 1.3rem; }

.value-box { border: 1px solid #86efac; background: #ecfdf5; border-radius: 10px; padding: 10px 12px; }
.main-value { font-size: 3.3rem; font-weight: 800; color: #16a34a; line-height: 1; }
#mainMetricLabel { font-size: 1.5rem; color: #4b5563; }
.severity-badge { font-size: 1.4rem; color: #16a34a; }

.ts-head h5 { font-size: 2.1rem; font-weight: 700; }
.chart-wrap { height: 420px; border: 1px solid #e5e7eb; border-radius: 10px; padding: 6px; }
#tsChart { width: 100%; height: 100%; }

.trend-card { border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px; background: #f9fafb; }
.trend-card h6 { font-size: 1.7rem; font-weight: 700; }
.kpi-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
.kpi-card { background: white; border: 1px solid #dfe3e8; border-radius: 7px; padding: 8px; }
.kpi-card small { display: block; font-size: 1.2rem; color: #64748b; }
.kpi-card strong { font-size: 1.35rem; }
.trend-text { color: #16a34a; font-size: 1.3rem; font-weight: 600; }
.panel-spinner { display:flex; align-items:center; gap:8px; font-size:1.2rem; }

.bottom-timeline {
  position: absolute;
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 940;
  border-radius: 12px;
  box-shadow: var(--shadow);
  min-width: min(1220px, calc(100vw - 320px));
}
.timeline-date { width: 170px; }
.timeline-level { width: 170px; }
.month-strip-shell { border-top: 1px solid #e5e7eb; padding: 4px 8px; display: flex; align-items: center; gap: 6px; background: #fff; }
.strip-nav { border: 0; background: #f3f4f6; color: #475569; border-radius: 6px; width: 28px; height: 24px; }
.month-strip { display: flex; overflow-x: auto; gap: 0; flex: 1; scrollbar-width: thin; align-items: center; }
.month-chip { border: 0; border-right: 1px solid #e5e7eb; background: #fff; padding: 2px 9px; font-size: .75rem; white-space: nowrap; color: #64748b; }
.month-chip.active { color: #2563eb; font-weight: 700; background: #eff6ff; }
.month-chip .year-tag { display: block; font-size: .65rem; color: #f97316; }

.right-tab {
  position: absolute;
  right: 0;
  top: 110px;
  z-index: 980;
  writing-mode: vertical-rl;
  text-orientation: mixed;
  background: #111827;
  color: #f97316;
  border-radius: 10px 0 0 10px;
  padding: 12px 8px;
  font-size: 1.5rem;
}

.reload-btn { position: absolute; top: 84px; right: 470px; z-index: 930; border: 0; background: #fff; border-radius: 50%; width: 34px; height: 34px; box-shadow: var(--shadow); }
.map-loading { position:absolute; top:80px; right:520px; z-index:970; background:rgba(255,255,255,.94); border:1px solid var(--stroke); border-radius:10px; padding:6px 10px; font-size:.85rem; display:none; align-items:center; gap:8px; }
.map-loading.show { display:flex; }

.map-legend { background: rgba(255,255,255,.95); border: 1px solid #dbe5f4; border-radius: 12px; padding: 10px; box-shadow: 0 8px 20px rgba(0,0,0,.15); line-height: 1.2; min-width: 165px; }
.map-legend h6 { margin: 0 0 8px 0; font-size: .84rem; }
.map-legend .head { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
.map-legend .toggle { border: 1px solid #dbe4f2; background: #f8fafc; border-radius: 6px; width: 24px; height: 24px; padding: 0; }
.map-legend .row-item { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; font-size: .8rem; }
.map-legend .sw { width: 14px; height: 14px; border-radius: 4px; border: 1px solid #fff; }
.map-legend.compact { min-width: auto; }
.map-legend .short { font-weight:700; width:24px; display:inline-block; }
.map-legend.compact .label, .map-legend.compact h6 { display: none; }
.leaflet-bottom.leaflet-right .map-legend { margin-bottom: 110px; }

.modal-backdrop-custom { position: absolute; inset: 64px 0 0 0; background: rgba(15, 23, 42, 0.2); z-index: 790; opacity: 0; pointer-events: none; transition: opacity .2s ease; }
.modal-backdrop-custom.open { opacity: 1; }

@media (max-width: 1400px) {
  .headline h1 { font-size: 1.35rem; }
  .headline small, .layers-panel h5, .layer-section label, .trend-card h6, .insight-header h4 { font-size: 1rem; }
  .brand { font-size: 1.8rem; }
  .layers-panel { width: 250px; top: 180px; }
  .insight-panel { width: 360px; }
  .kpi-grid { grid-template-columns: repeat(2, 1fr); }
  .bottom-timeline { min-width: calc(100vw - 300px); }
}

@media (max-width: 992px) {
  .layers-panel { display: none; }
  .quick-tools { display: none; }
  .insight-panel { width: min(380px, calc(100vw - 24px)); }
  .bottom-timeline { min-width: calc(100vw - 24px); }
  .reload-btn, .right-tab { display: none; }
}
